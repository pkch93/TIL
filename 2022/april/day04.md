# 2022.04.04 TIL - 통합 테스트

- [2022.04.04 TIL - 통합 테스트](#20220404-til---통합-테스트)
  - [통합 테스트를 작성하는 지침](#통합-테스트를-작성하는-지침)
    - [빠른 실패 원칙](#빠른-실패-원칙)
    - [프로세스 외부 의존성](#프로세스-외부-의존성)
      - [외부 의존성의 두 가지 유형](#외부-의존성의-두-가지-유형)
      - [관리 의존성의 실제 인스턴스를 활용할 수 없는 경우](#관리-의존성의-실제-인스턴스를-활용할-수-없는-경우)

통합 테스트란 단위 테스트의 범주 외에 있는 테스트를 말한다.

> 단위 테스트는 다음 세 가지 요구사항을 충족하는 테스트이다.
>
> 1. 단일 동작 단위를 검증
> 
> 2. 빠르게 수행
> 
> 3. 다른 테스트와 별도로 처리

단위 테스트의 세 가지 요구사항 중 하나라도 충족하지 못하면 통합 테스트의 범주에 속한다.

보통 통합 테스트는 프로세스 외부 의존성과 통합하여 어떻게 작동하는지를 검증하는데 사용한다. 즉, 테스트 코드 사분면의 컨트롤러 테스트에 해당한다.

![](https://user-images.githubusercontent.com/30178507/161561093-e6fe2518-6e1a-491d-98a2-03f0e4dfa70c.png)

즉, 데이터베이스 등 다른 서브 시스템과 통합하여 어떻게 작동하는지 확인하는 것이 통합 테스트가 가진 의미이다.

## 통합 테스트를 작성하는 지침

통합 테스트는 다른 서브 시스템들과 통합하여 예상한대로 잘 동작하는 지 확인하는 테스트가 되어야한다.

따라서 통합 테스트에서 **프로세스 외부 의존성과의 상호 작용을 모두 확인하려면 가장 긴 주요 흐름을 테스트**해야한다. 만약 모든 상호작용을 거치는 흐름이 없다면 **외부 시스템과의 통신을 확인하는 데 필요한 만큼 통합 테스트를 추가로 작성**해야한다. 단, 예외 상황에 잘못 실행하여 애플리케이션이 즉시 실패한다면 해당 예외 상황은 테스트할 필요가 없다. 통합 테스트에서 예외 상황을 테스트하려고 한다면 **빠른 실패 원칙** 적용을 고려해볼 수 있다.

### 빠른 실패 원칙

빠른 실패 원칙은 예기치 않은 오류가 발생하자마자 연산을 중단하는 원칙이다. 버그를 빠르게 발견하도록 만들어 주며 버그가 데이터베이스와 같은 영속성 영역까지 침투하는 것을 방지할 수 있다.

빠른 실패의 대표적인 예시가 바로 전제조건이다. 전제조건이 맞지 않으면 바로 연산을 종료할 수 있다. 이를 통해 잘못된 조건으로 프로그램이 실행되는 것을 방지할 수 있다.

### 프로세스 외부 의존성

통합 테스트는 다른 서브 시스템, 즉, 다른 외부 의존성과 어떻게 통합하는지를 검증하는 것이다. 이를 검증하는 방식은 실제 외부 의존성을 사용하는 방식과 Mock을 활용하는 방식이 있다.

실제 의존성을 사용할 지 Mock을 사용할 지는 의존성의 유형에 따라 달라진다.

#### 외부 의존성의 두 가지 유형

외부 의존성은 관리 의존성과 비관리 의존성 2가지 유형으로 나눌 수 있다.

- 관리 의존성
    
    애플리케이션에서 전체 제어가 가능한 의존성을 관리 의존성이라고 한다. 해당 의존성과의 상호작용은 애플리케이션 외부에서는 볼 수 없다. 대표적인 예시로 애플리케이션에서 사용하는 데이터베이스가 있다.
    
    관리 의존성은 구현 세부 사항에 해당하므로 실제 인스턴스를 사용해야한다.
    
- 비관리 의존성
    
    전체를 제어할 수 없는 외부 의존성을 비관리 의존성이라고 한다. 해당 의존성과의 상호 작용을 외부에서 볼 수 있는 경우에 비관리 의존성으로 간주한다.
    
    비관리 의존성은 시스템의 식별 가능한 동작이므로 Mock을 활용하는 것이 좋다.
    

#### 관리 의존성의 실제 인스턴스를 활용할 수 없는 경우

만약 관리 의존성이 데이터베이스라고 가정한다. 이 데이터베이스를 Mock으로 대체하는 경우 통합 테스트의 리팩터링 내성이 사라진다. 이 경우 회귀 방지 효과도 떨어진다. 결국 이 통합 테스트는 컨트롤러가 어떤 데이터베이스 접근 메서드를 호출하는지 정도 밖에 테스트하지 않는다. 단위 테스트와 다를 바 없어지는 것이다.

때문에 실제 인스턴스를 가지고 테스트할 수 없는 관리 의존성의 경우는 차라리 통합 테스트를 작성하지 않는 것이 바람직하다. 그 시간에 단위 테스트에 더 집중하자.
