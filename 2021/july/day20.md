# 2021.07.20 TIL - Amazon Route 53

Amazon Route 53은 Amazon의 관리형 DNS 서비스로 EC2 인스턴스, ELB, S3 버킷 등 AWS 내의 인프라에 DNS를 연결시키거나 AWS 외부의 인프라에도 연결 가능하다.

Amazon Route 53는 100% SLA를 보장하는 유일한 서비스이다.

> SLA란 서비스 수준 협약 `Service-Level Agreement`의 약자로 보통 호스팅 업체가 사용자와 맺는 계약이다. 즉, 호스팅 업체는 어느 정도의 서비스를 제공할지를 정하고 계약이 깨졌을때 어느정도의 보상을 할 지에 대한 계약이다.

여기서 Amazon Route 53은 100%의 서비스 수준을 제공하도록 계약한다.

Amazon Route 53 SLA: [https://d1.awsstatic.com/legal/AmazonRoute53SLA/Amazon Route 53 Service Level Agreement - Korean (2018-11-21).pdf](https://d1.awsstatic.com/legal/AmazonRoute53SLA/Amazon%20Route%2053%20Service%20Level%20Agreement%20-%20Korean%20(2018-11-21).pdf)

Amazon Route 53은 리전과는 독립적이기 때문에 다수의 리전을 교차해서 연결할 수 있으며 다수의 리전과 AWS VPC 간의 DNS 주소 변환, 퍼블릭 DNS 관리 기능, 도메인 등록, 신규 도메인을 위한 DNS 레코드 생성, 기존 도메인에 DNS 레코드 전송 등의 기능을 제공한다.

## Amazon Route 53의 DNS 레코드 타입

Amazon Route 53에서는 다음과 같은 DNS 레코드 타입을 지원한다.

- A `주소 기록`
- AAAA `IPv6 주소 기록`
- CNAME `캐노니컬 네임 기록`
- CAA `인증 권한 증명`
- MX `메일 교환 기록`
- NAPTR `네임 권한 포인터 기록`
- NS `네임 서버 기록`
- PTR `포인터 기록`
- SOA `권한 시작 기록`
- SPF `송신자 정책 프레임워크`
- SRV `서비스 위치 표시`
- TXT `텍스트 기록`

## Amazon Route 53의 라우팅 정책

- 가중치 라운드 로빈

    도메인에 대응되는 리소스가 여러개인 경우 리소스 별로 트래픽을 분산할 수 있으며 이를 통해 A/B 테스팅, 카나리 배포 등에 활용할 수 있다.

- 지연 기반 라우팅

    다수의 AWS 리전에서 실행되는 애플리케이션을 Route 53 엣지 로케이션에 연결하여 최저 지연 시간으로 서비스를 제공할 수 있다.

- 장애 대응 라우팅

    장애 대응을 통해 가용 리소스 쪽으로 라우팅이 필요한 경우에 사용한다. 정상적으로 동작하는 리전의 리소스를 활용하여 트래픽을 라우팅할 수 있다.

- 지역 DNS 라우팅

    사용자의 지역에 따라 DNS 쿼리에 응답하도록 하는 경우 사용한다. 요청 발신지를 기준으로 가장 가까운 엔드포인트로 트래픽을 라우팅하고 특정 지역에서는 제공되어야하지 않는 서비스가 있다면 배포되지 않도록 할 수 있다.

추가로 Route 53는 애플리케이션, 웹 서버 등 리소스에 대한 성능을 모니터링하는 헬스 체크 기능을 제공하며, 동일한 기능을 수행하는 두 개 이상의 리소스를 운영하는 경우 특히 유용하다. 예를 들어, `example.com` 웹사이트에 대한 요청에 응답하기 위해 다수의 EC2 인스턴스로 HTTP 서버를 구현한 경우 모든 리소스의 헬스 상태가 좋다면 Route 53는 `example.com` 리소스에 대한 요청에 문제 없이 응답 할 수 있다. 다만, 리소스의 헬스 상태가 나빠졌다면 Route 53는 헬스 상태가 좋은 리소스만을 활용 해서 `example.com`의 요청에 대응하게 되며, 특정 EC2 서버가 다운되거나 특정 AZ 전체가 다운된 경우, 해당 리소스를 제외하고 헬스 상태가 좋은 리소스만으로 서비스를 제공할 수 있다.
