# 2021.07.21 TIL - AWS SQS, Amazon SNS

## AWS SQS

AWS SQS는 AWS에서 제공하는 완전관리형 메세지 큐 서비스이다. 분산 아키텍처 환경에서 비동기로 이벤트 기반 아키텍처를 구현하기 위해서 주로 사용한다.

Amazon SQS를 이용해 각 리전에서 다중 AZ를 중복 구현할 수 있으며, 특정 AZ에 문제가 발생해도 서비스는 정상 작동된다. 다수의 복제메세지를 다중 AZ 환경에 저장 할 수 있으며, 메시지는 최대 14일간 유지된다.

> 메세지 보관 기간은 14일 이내로 설정할 수 있다.

분산 아키텍처 환경을 기반으로 하므로 Amazon SQS는 별도의 프로비저닝 없이 확장한다. 트래픽이 많아지면 자동으로 스케일업하고, 트래픽이 감소하면 자동으로 스케일 다운한다.

SQS 메시지는 최대 256KB의 XML, JSON, 특정한 포멧 없이 텍스트 데이터를 담을 수 있다.

### AWS SQS 큐 타입

AWS SQS에는 스탠다드 큐와 FIFO 큐를 선택할 수 있다.

- 스탠다드 큐

    SQS의 기본 큐 타입으로 초당 거의 무제한의 트랜잭션을 지원한다. 최소 1회 메시지 전송을 보장하고, 전송 순서대로 도착하는 하는 것을 보장하는 전송 순서 보장 기능을 제공한다. 다만, 스탠다드 큐는 메시지의 순서를 저장하지만, 가끔은 순서와 다른 메시지가 전송되기도한다.

- FIFO 큐

    큐에 들어온 순서대로 보장하는 SQS 타입으로 메세지를 여러 번 전송하더라도 순서가 바뀌지 않는 것이 특징이다. 다만, 처리 성능은 초당 300회의 트랜잭션으로 제한된다.

### DLQ `Dead Letter Queue`

AWS SQS에서는 처리하지 못한 메세지를 버리지 않고 담아두도록 DLQ 기능을 제공한다. DLQ를 통해 처리되지 못한 메세지만 따로 디버깅하거나 처리할 수 있도록 만들어준다.

## Amazon SNS

Amazon SNS는 클라우드 기반의 Notification 서비스로 애플리케이션에서 메세지를 전송하면 즉시 구독 대상이 수신할 수 있도록 하는 publish-subscribe 매커니즘을 기반으로 한다.

Amazon SNS도 AWS SQS와 마찬가지로 완전관리형 서비스로서 다중 AZ 환경으로 구현되어 있다. 이를 통해 고신뢰성, 고가용성을 제공한다.

SNS에서는 토픽 `topic`이라는 개념으로 publisher를 생성할 수 있다. 이 토픽에 여러 subscriber를 지정하여 토픽에 전달된 메세지가 subscriber에게 전송되도록 만들 수 있다.

Amazon SNS에도 FIFO와 스탠다드로 타입을 선택할 수 있다. 다만, FIFO의 경우는 SQS만 구독이 가능한 반면 스탠다드의 경우 SQS, AWS Lambda, HTTP, SMS, 이메일, 모바일 애플리케이션의 엔드포인트에 구독이 가능하다.
