# 2021.06.22 TIL - AMI 가상화

- [2021.06.22 TIL - AMI 가상화](#20210622-til---ami-가상화)
  - [HVM vs PV](#hvm-vs-pv)

Linux AMI는 HVM `하드웨어 가상머신` 방식과 PV `반가상화` 방식을 사용한다.

> 현 세대 인스턴스는 모두 HVM을 지원한다. PV는 이전 세대 인스턴스에서 지원.

- HVM AMI

    HVM은 루트 블록 디바이스의 부트 마스터 레코드를 실행한 후 운영체제에 하드웨어의 모든 설정 내용을 가상화한다. 즉, 운영체제는 VM 바로 위에서 실행하는 상태가 된다. 이를 통해 별다른  수정 작업 없이 가상 머신 위에서 직접 운영체제를 실행하므로 베어 메탈 하드웨어에서 실행하는 것과 유사하다.

    현 세대 인스턴스 타입은 HVM AMI를 지원한다.

- PV AMI

    PV는 PV-GRUB라고 부르는 부트로더를 통해 부팅하며 부트 사이클을 실행한 뒤 머신 이미지에 있는 menu.lst 파일에 정의된 커널을 로딩한다.

    PV는 반가상화 방식이므로 HVM에서 제공하는 강화 네트워킹이나 GPU 프로세싱 등의 기능을 활용할 수 없다.

    PV는 현 세대 인스턴스 타입에서는 지원하지 않으며 이전 세대 인스턴스에서 지원한다.

## HVM vs PV

\ | HVM | PV
:--: | :--: | :--:
설명 | HVM AMIs는 이미지 루트 블록 디바이스의 마스터 부트 레코드를 실행하여 완벽하게 가상화된 하드웨어 및 부트 세트를 함께 제공합니다. 이 가상화 유형은 운영 체제 미설치 하드웨어에서 실행될 때처럼 가상 머신에서 운영 체제를 수정하지 않고 실행할 수 있습니다. Amazon EC2 호스트 시스템은 게스트에게 제공되는 기본 하드웨어의 일부 또는 모두를 에뮬레이트합니다. | PV AMIs는 PV-GRUB라는 특수 부트 로더를 통해 부팅되며, 이 로더는 부팅 주기를 시작한 후 사용자 이미지의 menu.lst 파일에 지정된 커널을 체인 로드합니다. 반가상화 게스트는 가상화를 명시적으로 지원하지 않는 하드웨어에서 실행할 수 있습니다. 이전에는 대부분의 경우 PV 게스트가 HVM 게스트보다 더 나은 성능을 제공했지만, HVM 가상화 기능이 향상되고 HVM AMI용 PV 드라이버가 제공되는 현재는 더 이상 그렇지 않습니다. PV-GRUB 및 Amazon EC2에서의 사용에 대한 자세한 내용은 자체 Linux 커널 활성화 단원을 참조하십시오.
하드웨어 확장 지원 | 예. PV 게스트와 달리 HVM 게스트는 하드웨어 확장을 활용하여 호스트 시스템의 기본 하드웨어에 빠르게 액세스할 수 있습니다. Amazon EC2에서 제공되는 CPU 가상화 확장에 대한 자세한 내용은 Intel 웹 사이트의 Intel Virtualization Technology를 참조하십시오. 향상된 네트워킹 및 GPU 처리를 활용하려면 HVM AMI가 필요합니다. 특수 네트워크 및 GPU 디바이스에 대한 명령을 통과하기 위해 OS는 기본 하드웨어 플랫폼에 액세스할 수 있어야 하고, HVM 가상화는 이 액세스 기능을 제공합니다. 자세한 내용은 Linux에서 향상된 네트워킹 및 Linux 액셀러레이티드 컴퓨팅 인스턴스 섹션을 참조하세요. | 아니요. 향상된 네트워킹 또는 GPU 처리와 같은 특수 하드웨어 확장을 활용할 수 없습니다.
지원되는 인스턴스 유형 | 모든 최신 인스턴스 유형은 HVM AMI를 지원합니다. | C1, C3, HS1, M1, M3, M2, T1 등과 같은 전 세대 인스턴스 유형은 PV AMI를 지원합니다. 최신 세대 인스턴스 유형은 PV AMI를 지원하지 않습니다.
지원하는 리전 | 모든 리전은 HVM 인스턴스를 지원합니다. | 아시아 태평양(도쿄), 아시아 태평양(싱가포르), 아시아 태평양(시드니), 유럽(프랑크푸르트), 유럽(아일랜드), 남아메리카(상파울루), 미국 동부(버지니아 북부), 미국 서부(캘리포니아 북부 지역) 및 미국 서부(오레곤)
검색 방법 | 콘솔 또는 describe-images 명령을 사용하여 AMI의 가상화 유형이 hvm로 설정되어 있는지 확인합니다. | 콘솔 또는 describe-images 명령을 사용하여 AMI의 가상화 유형이 paravirtual로 설정되어 있는지 확인합니다.
