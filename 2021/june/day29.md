# 2021.06.29 TIL - IAM 기본

AWS IAM은 AWS 클라우드 인프라에서의 신분 및 접속 관리 서비스로 사용자와 사용자 그룹이 보안이 유지된 상태에서 AWS 리소스에 접근할 수 있도록 해준다.

이를 통해 특정 유저가 어떤 서비스를 사용할지 정할 수 있고 해당 유저에 어떤 권한을 부여할지도 정할 수 있으며, AWS 리소스에 대한 신분 인증 및 접근 권한 관리를 수행할 수 있다.

> AWS IAM Docs에서는 루트 사용자를 사용하지 않는 것을 권장한다.

## IAM 용어 정리

- 리소스

    IAM에 저장된 사용자, 그룹, 정책 및 자격 증명 공급자 객체. 다른 AWS 서비스와 마찬가지로 IAM에서 리소스를 추가, 편집 및 제거할 수 있다.

- ID

    식별 및 그룹화에 사용되는 IAM 리소스 객체. 정책을 IAM 자격 증명에 연결할 수 있습니다. 여기에는 사용자, 그룹 및 역할이 포함된다.

- 엔티티

    AWS가 인증에 사용하는 IAM 리소스 객체. 여기에는 IAM 사용자, 연합된 사용자 및 수임된 IAM 역할이 포함된다.

- 보안 주체

    AWS 계정 루트 사용자, IAM 사용자 또는 IAM 역할을 사용하여 로그인하고 AWS에 요청하는 사람 또는 애플리케이션. 보안 주체는 AWS 계정 루트 사용자 또는 IAM 엔터티로 인증되어 AWS에 요청한다. 일별 작업에 대한 루트 사용자 자격 증명은 사용하지 않는 것이 가장 좋다.

## IAM 기능

- AWS 계정에 대한 공유 엑세스

    암호나 엑세스 키를 공유하지 않고도 AWS 계정의 리소스를 관리하고 사용할 수 있는 권한을 다른사람에게 부여할 수 있다.

- 세분화된 권한

    리소스에 따라 여러 사람에게 다양한 권한을 부여할 수 있다. 사용자마다 접근할 수 있는 리소스를 달리할 수 있다.

- 멀티 팩터 인증 `MFA`

    기존에 엑세스 키, 패스워드 방식 말고도 보안을 위해 계정과 개별 사용자에서 2팩터 인증을 추가할 수 있다.

- EC2에서 실행되는 애플리케이션을 위한 보안 AWS 리소스 엑세스

    EC2 인스턴스에서 실행되는 애플리케이션의 경우 같은 계정에서 소유한 AWS 리소스에 엑세스할 수 있는 권한을 제공한다.

- 자격 증명 연동
- 보증을 위한 자격 증명 정보

    AWS CloudTrail을 사용하는 경우 계정의 리소스를 요청한 사람에 대한 정보가 포함된 로그 레코드를 받을 수 있다.

- AWS 서비스와의 통합
- 최종 일관성

    IAM은 전 세계의 Amazon 데이터 센터 내의 여러 서버로 데이터를 복제하여 고가용성을 구현한다. 때문에 모든 데이터가 저장/변경이 완료된 경우에만 변경된 데이터에 접근하는 최종 일관성 `eventually consistent`을 제공한다. 

- 무료 사용

    AWS IAM 및 AWS STS는 추가 비용 없이 AWS 계정에 제공하는 기능이다. IAM 사용자나 AWS STS 임시 보안 자격 증명으로 다른 AWS 서비스에 접근하는 경우에만 요금이 부과된다.

## IAM 작동 방식

### 인증

보안 주체는 AWS에 요청을 보내기 위해서 자격 증명을 이용하여 인증을 받아야한다. `AWS에 로그인`
Amazon S3나 AWS STS 같은 일부 서비스에서는 익명 사용자의 몇 가지 요청을 허용한다. 단, 이는 예외 규칙이다.

루트 사용자로서 콘솔에서 인증하려면 이메일 주소 및 암호로 로그인해야 한다. IAM 사용자로서 계정 ID 또는 별칭을 입력한 다음 사용자 이름과 암호를 입력한다. API 또는 AWS CLI에서 인증하려면 액세스 키 및 보안 키를 제공해야한다. 추가 보안 정보도 제공해야 할 수 있다. 예를 들어, AWS는 멀티 팩터 인증 `MFA`을 사용하여 계정의 보안을 강화하는 것을 권장한다.

### 권한 부여

인증 이외에 요청을 완료할 수 있는 권한이 있어야한다. IAM을 사용하면 클라우드 내에서 사용자의 행동을 세부적으로 관리할 수 있으며 이를 통해서 '최소한의 권한 부여 및 책임의 분리'라는 보안 컨셉을 구현할 수 있다.

AWS에서는 IAM 정책 방식으로 권한을 부여한다. IAM 정책은 유저, 그룹, 롤 등 어떤 IAM 엔티티에도 적용이 가능하고 유저 또는 그룹이 할 수 있는 행동, 접근 가능한 리소스의 종류, 실행 결과 등 클라우드에서 일어나는 거의 모든 권한 부여 업무를 정의할 수 있다. 정책은 Json 문서로 정의된다.
