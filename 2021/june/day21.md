# 2021.06.21 TIL - AMI

AMI는 AWS에서 실행되는 서버에 대한 모든 소프트웨어 환경설정 정보를 포함한 기본 설계도 또는 청사진과 같다.

AMI는 다음을 포함한다.

- 1개 이상의 Amazon Elastic Block Store `EBS` 스냅샷 또는, 인스턴스 스토어 기반 AMI의 경우, 인스턴스의 루트 볼륨에 대한 템플릿 `운영 체제, 애플리케이션 서버, 애플리케이션`
- AMI를 사용하여 인스턴스를 시작할 수 있는 AWS 계정을 제어하는 시작 권한 `launch permission`

    시작 권한으로 퍼블릭 `Public`, 명시적 `Explicit`, 암묵적 `Implicit`으로 분류된다.

- 시작될 때 인스턴스에 연결할 볼륨을 지정하는 블록 디바이스 매핑

    즉, 실행할 인스턴스에 어떤 볼륨 타입을 부착할지를 정의한 블록 디바이스 매핑 정보가 포함되어있다.

## 인스턴스 루트 볼륨 `Instance Root Volume`

모든 AMI는 Amazon EBS 기반 AMI와 인스턴스 스토어 기반 AMI로 분류된다. Amazon EBS 기반 AMI는 루트 디바이스가 Amazon EBS 스냅샷에서 생성된 EBS 볼륨이라는 것을 의미하는 반면 인스턴스 스토어 기반 AMI는 루트 디바이스가 Amazon S3에 저장된 템플릿에서 생성된 인스턴스 스토어 볼륨이라는 것을 의미한다.

### EBS 기반 AMI vs 인스턴스 스토어 기반 AMI

특성 | EBS 기반 AMI | 인스턴스 스토어 기반 AMI
:--: | :--: | :--:
인스턴스의 부팅 시간 | 일반적으로 1분 이하 | 일반적으로 5분 이하
루트 디바이스의 크기 제한 | 16TiB | 10GiB
루트 디바이스 볼륨 | EBS 볼륨 | 인스턴스 스토어 볼륨
데이터 지속성 | 기본적으로 인스턴스가 종료되면 루트 볼륨이 삭제됩니다. 다른 EBS 볼륨의 데이터는 기본적으로 인스턴스 종료 후에도 유지됩니다. | 모든 인스턴스 스토어의 데이터는 인스턴스 수명 주기 동안만 유지됩니다.
수정 | 인스턴스 유형, 커널 RAM 디스크 및 사용자 데이터는 인스턴스가 중지된 동안에 변경될 수 있습니다. | 인스턴스 속성은 인스턴스 수명 주기 동안 고정됩니다.
요금 | 인스턴스 사용량, EBS 볼륨 사용량 및 AMI를 EBS 스냅샷으로 저장하는 것에 대한 비용이 청구됩니다. | 인스턴스 사용량 및 Amazon S3에 AMI를 저장하는 것에 대한 비용이 청구됩니다.
AMI 생성/번들링 | 단일 명령/호출을 사용합니다 | AMI 도구를 설치 및 사용해야 합니다
중지 상태 | 중지 상태일 수 있습니다. 인스턴스가 중지되고 실행 중이지 않은 경우에도 루트 볼륨은 Amazon EBS에 유지됩니다. | 중지 상태가 될 수 없습니다. 인스턴스가 실행 중이거나 종료되었습니다

> 참고로 EBS 루트 볼륨의 `DeleteOnTermination` 값은 true로 설정되어있다.
