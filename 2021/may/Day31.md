# 2021.05.31 TIL - 아마존 글래이셔

## 아마존 글레이셔

아마존 글레이셔는 데이터 아카이브 및 장기보관 백업을 위한 저비용 클라우드 스토리지이다. S3와 같이 높은 신뢰성과 안전성을 제공하지만 매우 낮은 비용으로 이용할 수 있다. 아마존 글레이셔의 데이터 저장 비용은 **월 1GB당 0.004 달러**로 매우 저렴하다.

### 주요 용어

- 데이터 업로드

    **아마존 글레이셔에 데이터를 업로드 한다는 뜻은 데이터 아카이브에 저장한다는 뜻**이다.

    하나의 파일을 업로드하면 해당 파일에 대한 아카이브가 생성되는데 이는 비효율적이기 때문에 tar나 zip 등으로 압축하여 업로드할 것을 권장한다. 또한 개별 파일마다 아카이브를 구성하는 것보다 여러 개의 데이터를 하나의 파일로 묶어서 아카이브를 구성하는 편이 훨씬 저렴하다.

    아마존 글레이셔도 S3와 마찬가지로 업로드 수에 제한은 없으며 하나의 아카이브에 대한 용량은 최대 40TB까지 지원한다. 아카이브는 기본적으로 불변 `immutable` 이므로 아카이브한 데이터를 수정할 수 없다. 만약 업로드한 데이터를 수정하고 싶다면 삭제 후 재업로드해야한다.

    아마존 글레이셔는 멀티파트 업로드 기능도 제공한다. 만약 100MB 이상의 아카이브를 업로드한다면 더 작은 단위로 세분화하여 개별적으로 전송되는 멀티파트 업로드 기능을 추천한다. 멀티파트 업로드를 통해 개별적으로 올라간 데이터들은 업로드 완료 후 다시 하나의 아카이브로 합쳐진다. 단일 업로드 요청이 가능한 최대 아카이브 크기는 4GB이다.

- 볼트 `vault`

    볼트란 금고, 사물함의 기능을 수행한다. 즉, 볼트는 아카이브용 컨테이너라고 할 수 있고 글레이셔 내부 데이터 구조를 정리하는데 활용할 수 있다. 여러 개의 아카이브로 하나의 그룹을 만들고 이를 하나의 볼트로 넣어두는 방식으로도 활용할 수 있다.

    각 글레이셔 볼트는 다음과 같이 유일무이한 주소를 가진다.

    ```
    https://(region-specific endpoint)/(account-id)/vaults/(vault-name)/
    archives/(archive-id)
    ```

    볼트마다도 서로 다른 접근 권한을 부여할 수 있으며 다양한 권한 수준을 설정할 수 있다. 리전당 그리고 계정당 최대 1,000개의 볼트를 생성할 수 있다. 볼트를 삭제하려면 볼트에 있는 데이터 삭제가 선행되어야한다.

- 글레이셔 잡

    아카이브나 볼트에서 데이터를 인출하려면 인출 요청을 담은 글레이셔 잡을 제출해야한다. 이 작업은 글레이셔 내에서 비동기적으로 이뤄지며 관련된 잡 유형, 잡 생성 날짜, 잡 상태, 완료 날짜 등 연관 정보가 글레이셔에 기록된다. 글레이셔 잡이 종료되면 원하는 파일인 **잡 아웃풋**을 다운로드할 수 있다.

    글레이셔는 알림 기능을 제공하므로 잡 종료시 해당 내용을 알려주도록 설정할 수 있으며 AWS SNS도 활용할 수 있다.

### 파일 업로드

파일 업로드는 간단하게 인터넷 연결이나 AWS Direct Connect를 통해 기업 데이터센터에 있는 데이터를 업로드 할 수 있다.

> [AWS Direct Connect](https://aws.amazon.com/ko/directconnect/)는 온프레미스에서 AWS로 전용 네트워크 연결을 쉽게 설정할 수 있는 클라우드 서비스 솔루션이다.

만약 파일의 수나 양이 방대하다면 AWS Snowball을 사용하여 데이터를 이송하고 글레이셔로 업로드할 수 있다.

처음 글레이셔에 업로드 하는 경우 볼트를 생성한다. 그리고 볼트에 대한 접근 정책을 정의한 후에 데이터를 글레이셔에 업로드를 할 수 있다.

### 파일 다운로드

아마존 글레이셔에는 세 가지 방식으로 파일을 가져올 수 있다.

- 스탠다드 `Standard`

    몇 시간이 소요되는 저비용 데이터 인출 방식이다. 인출에 3~5시간이 소요되며 1GB당 0.01 달러의 비용이 부과된다.

- 엑스퍼다이티드 `Expedited`

    소수의 아카이브에 대한 일시적이고 긴급한 인출방식이다. 인출에 1~5분이 걸리며 1GB당 0.03 달러의 비용이 부과된다.

- 벌크 `Bulk`

    페타바이트 급 데이터를 위한 최저비용 인출방식이다. 인출에 5~12시간이 소요되며 1GB당 0.0025 달러의 비용이 부과된다.

글레이셔에서 데이터를 인출하는 작업 또한 간단하며, 다음4단계를 거친다.

1. 데이터 인출을 위한 리트리벌 잡 `retrieval job` 을 제출한다.

    리트리벌 잡은 스탠다드, 엑스퍼다이티드, 벌크 타입을 설정할 수 있으며 제출 완료시 모니터링을 위한 잡ID가 생성된다.

2. 리트리벌 잡은 선택한 글레이셔 인출 타입에 따라 수 분에서 수 시간이 소요된다.
3. 리트리 벌 잡이 완료되면, 완료 알림 메시지가 나타난다.
4. 인출한 데이터를 다운로드한다.

S3 라이프사이클 정책을 활성화하면, 라이프사이클 관리를 통해 데이터를 복원할 수 있다.
