# 2021.11.25 TIL - DTO 코드 매핑에 대해서

- [2021.11.25 TIL - DTO 코드 매핑에 대해서](#20211125-til---dto-코드-매핑에-대해서)
  - [왜 DTO를 도메인 객체로 매핑해야할까?](#왜-dto를-도메인-객체로-매핑해야할까)
    - [DTO는 외부 의존성과 맞닿아있다.](#dto는-외부-의존성과-맞닿아있다)
    - [예외](#예외)
  - [팩토리 메서드 vs 팩토리 클래스](#팩토리-메서드-vs-팩토리-클래스)
    - [팩토리 메서드](#팩토리-메서드)
    - [팩토리 클래스](#팩토리-클래스)

웹 요청을 받거나 타 시스템, 데이터베이스 등에서 요청을 받아올때 응답을 위한 매핑 객체 만들어 사용한다. 이를 보통은 DTO `Data Transfer Object` 라고 한다.

DTO는 필수 불가결하다고 생각한다. DTO를 만들지 않는다면 필요한 응답에 대한 데이터를 프로그램 내에서 사용하기 불편할 것이다. 결국은 응답을 다르게 매핑할 다른 방법이 필요할 것이다.

그렇다고 DTO를 너무 도메인 로직 깊숙히 사용하는 것도 문제가 될 수 있다. 따라서 DTO를 적절한 도메인 객체로 매핑하는 과정이 필요하다.

## 왜 DTO를 도메인 객체로 매핑해야할까?

그렇다면 매핑한 DTO를 그대로 사용해야한다고 생각할 수 있다. DTO를 받아오는 이유가 결국은 응답의 결과 데이터가 필요하기 때문이고 그 데이터를 가장 잘 아는 객체가 DTO가 될 수 있다. 이런 이유로 DTO를 그대로 도메인 객체로 사용해도 문제 없을 것이라 생각할 수 있다.

### DTO는 외부 의존성과 맞닿아있다.

**객체가 변경될 이유는 단 하나여야한다.** 라는 객체지향의 가장 대표적인 원칙인 단일 책임 원칙 `SRP`을 떠올려본다. 만약 DTO에 도메인 로직, 즉, 비즈니스 요구사항이 녹아져있다면 해당 DTO는 외부 시스템 / 라이브러리의 변경과 비즈니스 요구사항의 변경 두 가지 이유에 대해 변경이 필요하다.

그리고 DTO는 직접 외부 시스템과 맞닿는 객체이므로 외부의 변화에 더욱 민감하게 변화할 수 있다. 비즈니스를 표현하는 도메인 객체를 따로 둔다면 외부 의존성에 대한 변경점을 지울 수 있으며 좀 더 비즈니스 요구사항에 집중할 수 있다.

### 예외

만약 요청하는 외부 의존성이 팀내 직접 개발하는 요소라면 No Mapping 전략을 고려해볼 수 있을 것 같다.
예를 들어 어드민 화면과 어드민 API 서버의 경우가 API 서버에 의존하는 외부 의존성이 팀에서 직접 개발하는 요소가 될 것이다.

## 팩토리 메서드 vs 팩토리 클래스

DTO를 도메인 객체로 매핑하기 위해서 일반 생성자를 활용할 수 있고 이름을 부여해서 팩토리 메서드를 만들 수 있다. 또한 객체 생성을 담당하는 팩토리 클래스 `변환 매핑 클래스`를 둘 수도 있다.

팩토리 메서드와 팩토리 클래스를 사용하면 좋을 상황에 대해 정리해본다.

### 팩토리 메서드

팩토리 메서드는 도메인 객체 내부에 선언되는 메서드이다. 도메인 객체 내부에 선언이 되기 때문에 도메인 객체의 필드를 매핑할 때 로직이 간단하거나 단순 전달하는 경우에 적합하다.

필드 매핑에 로직이 복잡한 경우 도메인 객체에서 표현하는 다른 비즈니스적인 표현들보다 매핑 코드들이 너무 널브러저 파악이 쉽지 않을 수 있다.

도메인 객체 내부에서 의존할 수 없는 요소가 있는 경우도 팩토리 메서드가 적절하지 않은 상황일 수 있다.

### 팩토리 클래스

팩토리 클래스는 팩토리 메서드를 사용할 수 없는 경우에 사용할 수 있다. 필드 매핑에 복잡한 로직이 포함되어야한다면 팩토리 클래스로 객체 매핑의 책임을 위임하는 것이 좋다. 이를 통해 도메인 객체에서는 도메인 비즈니스 로직에 집중할 수 있다.

도메인 객체에서는 의존할 수 없지만 팩토리 클래스에서 의존이 가능한 경우에는 팩토리 클래스를 사용하는게 맞을것이다.
